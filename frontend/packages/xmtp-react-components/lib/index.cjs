'use strict';

var outline = require('@heroicons/react/24/outline');
var react = require('react');
var Ie = require('react-18-blockies');
var jsxRuntime = require('react/jsx-runtime');
var dateFns = require('date-fns');
var reactSdk = require('@xmtp/react-sdk');
var contentTypeReply = require('@xmtp/content-type-reply');
var contentTypeRemoteAttachment = require('@xmtp/content-type-remote-attachment');
var contentTypeReaction = require('@xmtp/content-type-reaction');
var solid = require('@heroicons/react/24/solid');
var reactRouterDom = require('react-router-dom');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var Ie__default = /*#__PURE__*/_interopDefault(Ie);

var L={loading:"_loading_652o7_6 pulse",avatar:"_avatar_652o7_14",blockies:"_blockies_652o7_21"};var u=({url:e,isLoading:t,address:o})=>t?jsxRuntime.jsx("div",{className:L.loading}):e?jsxRuntime.jsx("img",{className:L.avatar,src:e,alt:o}):o?jsxRuntime.jsx(Ie__default.default,{"data-testid":"avatar",seed:o||"",scale:5,size:8,className:L.blockies}):jsxRuntime.jsx("div",{className:L.avatar});var b={wrapper:"_wrapper_ng5ay_1 pulse",element:"_element_ng5ay_6",element1Line:"_element1Line_ng5ay_11",element2Lines:"_element2Lines_ng5ay_16"};var I=({lines:e=1})=>jsxRuntime.jsx("div",{role:"status",className:b.wrapper,children:e===1?jsxRuntime.jsx("div",{className:`${b.element} ${b.element1Line}`}):jsxRuntime.jsxs("div",{className:b.element2Lines,children:[jsxRuntime.jsx("div",{className:b.element}),jsxRuntime.jsx("div",{className:b.element})]})});var c={wrapper:"_wrapper_82p7z_6",resolved:"_resolved_82p7z_15",element:"_element_82p7z_20",label:"_label_82p7z_26 text-sm",control:"_control_82p7z_32",input:"_input_82p7z_40 text-md text-sm",resolvedAddress:"_resolvedAddress_82p7z_54",displayAddress:"_displayAddress_82p7z_62",walletAddress:"_walletAddress_82p7z_67",subtext:"_subtext_82p7z_73",error:"_error_82p7z_80",leftIcon:"_leftIcon_82p7z_90"};var se=react.forwardRef(({ariaLabel:e,resolvedAddress:t,subtext:o,avatarUrlProps:r,onChange:a,isError:n,isLoading:s,label:p,onLeftIconClick:i,onTooltipClick:d,value:h},m)=>{let H=react.useCallback(A=>{a?.(A.target.value);},[a]),K=!!t?.displayAddress;return jsxRuntime.jsxs("div",{className:`${c.wrapper} ${K?c.resolved:""}`,children:[i&&jsxRuntime.jsx("div",{className:c.leftIcon,children:jsxRuntime.jsx(outline.ChevronLeftIcon,{onClick:i,width:24})}),jsxRuntime.jsxs("div",{className:c.element,children:[jsxRuntime.jsx("div",{className:c.label,children:p}),jsxRuntime.jsx(u,{...r}),jsxRuntime.jsxs("div",{className:c.control,children:[s?jsxRuntime.jsx(I,{lines:1}):t?.displayAddress?jsxRuntime.jsxs("div",{className:c.resolvedAddress,children:[jsxRuntime.jsx("span",{className:c.displayAddress,"data-testid":"recipient-wallet-address",children:t.displayAddress}),t.walletAddress&&jsxRuntime.jsx("span",{className:c.walletAddress,children:t.walletAddress})]}):jsxRuntime.jsx("input",{"data-testid":"message-to-input",tabIndex:0,className:c.input,id:"address",type:"text",spellCheck:"false",autoComplete:"false",autoCorrect:"false",autoCapitalize:"off",onChange:H,value:h,"aria-label":e,ref:m}),jsxRuntime.jsx("div",{className:`${c.subtext} ${n?c.error:""}`,"data-testid":"message-to-subtext",children:o})]})]}),d&&jsxRuntime.jsx(outline.InformationCircleIcon,{onClick:d,height:"24"})]})});se.displayName="AddressInput";var U={loading:"_loading_1s609_6",empty:"_empty_1s609_13",wrapper:"_wrapper_1s609_18"};var g={wrapper:"_wrapper_9fip8_1",selected:"_selected_9fip8_10",loading:"_loading_9fip8_14",element:"_element_9fip8_18",domain:"_domain_9fip8_26 text-sm",address:"_address_9fip8_35 text-md",message:"_message_9fip8_44 text-md",time:"_time_9fip8_56 text-xs"};var j={wrapper:"_wrapper_2nuo1_1 pulse",element:"_element_2nuo1_7"};var le=()=>jsxRuntime.jsx("div",{role:"status",className:j.wrapper,children:jsxRuntime.jsx("div",{className:j.element})});var Fe=()=>jsxRuntime.jsx("div",{children:"No conversations!"}),W=({conversations:e=[],isLoading:t,renderEmpty:o=jsxRuntime.jsx(Fe,{})})=>t&&!e.length?jsxRuntime.jsxs("div",{className:g.wrapper,children:[jsxRuntime.jsx(u,{isLoading:!0}),jsxRuntime.jsx("div",{className:g.element,children:jsxRuntime.jsx(I,{lines:2})}),jsxRuntime.jsx(le,{})]}):!e.length&&!t?jsxRuntime.jsx("div",{className:U.empty,children:o}):jsxRuntime.jsx("div",{className:U.wrapper,"data-testid":"conversations-list-panel",children:e});var O={wrapper:"_wrapper_gcqk3_1",date:"_date_gcqk3_16"};var V=({date:e})=>jsxRuntime.jsx("div",{className:O.wrapper,children:jsxRuntime.jsx("div",{className:O.date,title:e.toDateString(),children:dateFns.format(e,"PPP")})});var l={wrapper:"_wrapper_igutw_1 pulse",section:"_section_igutw_5",sectionRight:"_sectionRight_igutw_11",element:"_element_igutw_16",elementSmall:"_elementSmall_igutw_22",elementMedium:"_elementMedium_igutw_26",elementLarge:"_elementLarge_igutw_30",elementLast:"_elementLast_igutw_34"};var G=({incoming:e=!0})=>jsxRuntime.jsx("div",{role:"status",className:l.wrapper,children:e?jsxRuntime.jsxs("div",{className:l.section,children:[jsxRuntime.jsx("div",{className:`${l.element} ${l.elementSmall}`}),jsxRuntime.jsx("div",{className:`${l.element} ${l.elementLarge}`}),jsxRuntime.jsx("div",{className:`${l.element} ${l.elementMedium}`}),jsxRuntime.jsx("div",{className:`${l.element} ${l.elementLast}`})]}):jsxRuntime.jsxs("div",{className:`${l.section} ${l.sectionRight}`,children:[jsxRuntime.jsx("div",{className:`${l.element} ${l.elementSmall}`}),jsxRuntime.jsx("div",{className:`${l.element} ${l.elementLarge}`}),jsxRuntime.jsx("div",{className:`${l.element} ${l.elementMedium}`}),jsxRuntime.jsx("div",{className:`${l.element} ${l.elementLast}`})]})});var C={wrapper:"_wrapper_hnmk8_1",left:"_left_hnmk8_11",right:"_right_hnmk8_15",content:"_content_hnmk8_19",time:"_time_hnmk8_27",readReceipt:"_readReceipt_hnmk8_36",reactions:"_reactions_hnmk8_40"};var ce={attachment:"_attachment_m6zqf_1"};var X=new WeakMap,Ke=e=>(X.get(e.data)||X.set(e.data,URL.createObjectURL(new Blob([Buffer.from(e.data)],{type:e.mimeType}))),X.get(e.data)),_e=({message:e})=>{let{attachment:t,status:o}=reactSdk.useAttachment(e);if(o==="error")return "Unable to load attachment";if(o==="loading"||!t)return "Loading...";let r=Ke(t);return t.mimeType.startsWith("image/")?jsxRuntime.jsx("div",{className:ce.attachment,children:jsxRuntime.jsx("img",{src:r,alt:""})}):t.mimeType.startsWith("audio/")?jsxRuntime.jsx("audio",{controls:!0,src:r,children:jsxRuntime.jsx("a",{href:r,children:"Download instead"})}):t.mimeType.startsWith("video/")?jsxRuntime.jsxs("video",{controls:!0,autoPlay:!0,children:[jsxRuntime.jsx("source",{src:r,type:"video/mp4"}),"Video messages not supported."]}):jsxRuntime.jsx("div",{children:jsxRuntime.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",children:t.filename})})};var T={content:"_content_9xkgj_1",left:"_left_9xkgj_10",right:"_right_9xkgj_15",original:"_original_9xkgj_21"};var N=({message:e,isIncoming:t,isRepliedTo:o})=>{let r=reactSdk.ContentTypeId.fromString(e.contentType),a;return r.sameAs(reactSdk.ContentTypeText)&&typeof e.content=="string"&&(a=typeof e.content=="string"?e.content:void 0),(r.sameAs(contentTypeRemoteAttachment.ContentTypeAttachment)||r.sameAs(contentTypeRemoteAttachment.ContentTypeRemoteAttachment))&&(a=jsxRuntime.jsx(_e,{message:e})),jsxRuntime.jsx("div",{className:`${T.content} ${T[t?"left":"right"]} ${o?T.original:""}`,"data-testid":"message-tile-text",children:a??e.contentFallback??"This content is not supported by this client"})};var fe=({message:e,isIncoming:t})=>{let{originalMessage:o}=reactSdk.useReply(e),r=e.content,a={...e,content:r.content,contentType:new reactSdk.ContentTypeId(r.contentType).toString()};return jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[jsxRuntime.jsx("div",{children:o?jsxRuntime.jsx(N,{message:o,isIncoming:t,isRepliedTo:!0}):"Loading original message..."}),jsxRuntime.jsx("div",{children:jsxRuntime.jsx(N,{message:a,isIncoming:t})})]})};var S={wrapper:"_wrapper_l3px9_1",option:"_option_l3px9_11"};var tt=["\u{1F44D}","\u{1F44E}","\u2764\uFE0F"],Q=({conversation:e,message:t})=>{let{sendMessage:o}=reactSdk.useSendMessage(),r=react.useCallback(a=>{o(e,{content:a,schema:"unicode",reference:t.xmtpID,action:"added"},contentTypeReaction.ContentTypeReaction);},[e,t.xmtpID,o]);return jsxRuntime.jsx("div",{className:S.wrapper,children:tt.map(a=>jsxRuntime.jsx("button",{type:"button",className:S.option,onClick:()=>r(a),children:jsxRuntime.jsx("span",{className:S.emoji,children:a})},a))})};var k={wrapper:"_wrapper_1i67j_1",option:"_option_1i67j_8",count:"_count_1i67j_23",active:"_active_1i67j_28"};var st=["\u{1F44D}","\u{1F44E}","\u2764\uFE0F"],he=({conversation:e,message:t})=>{let{client:o}=reactSdk.useClient(),{sendMessage:r}=reactSdk.useSendMessage(),a=reactSdk.useReactions(t),n=react.useMemo(()=>a.filter(i=>i.schema==="unicode").reduce((i,d)=>{let h=(i?.[d.content]?.count??0)+1,m=i?.[d.content]?.senderAddresses??[];return {...i,[d.content]:{count:h,senderAddresses:[...m,d.senderAddress]}}},{}),[a]),s=react.useCallback(i=>n[i]?.count??0,[n]),p=react.useCallback(i=>{let d=n[i].senderAddresses.includes(o?.address??"");r(e,{content:i,schema:"unicode",reference:t.xmtpID,action:d?"removed":"added"},contentTypeReaction.ContentTypeReaction);},[o?.address,e,n,t.xmtpID,r]);return a.length>0&&jsxRuntime.jsx("div",{className:k.wrapper,children:st.map(i=>{let d=s(i);return d>0?jsxRuntime.jsxs("button",{type:"button",className:`${k.option} ${k.active}`,onClick:()=>p(i),children:[jsxRuntime.jsx("span",{className:k.emoji,children:i}),jsxRuntime.jsx("span",{className:k.count,children:d})]},i):null})})};var Z=({conversation:e,message:t,isIncoming:o,isRead:r})=>{let a=reactSdk.ContentTypeId.fromString(t.contentType);return jsxRuntime.jsxs("div",{className:`${C.wrapper} ${C[o?"left":"right"]}`,children:[a.sameAs(contentTypeReply.ContentTypeReply)?jsxRuntime.jsx(fe,{message:t,isIncoming:o}):jsxRuntime.jsx(N,{message:t,isIncoming:o}),jsxRuntime.jsxs("div",{className:C.time,title:t.sentAt.toLocaleString(),children:[r&&jsxRuntime.jsx("span",{className:C.readReceipt,children:"Read"}),jsxRuntime.jsx("span",{children:dateFns.format(t.sentAt,"h:mm a")})]}),jsxRuntime.jsx("div",{className:C.reactions,children:jsxRuntime.jsx(Q,{conversation:e,message:t})}),jsxRuntime.jsx(he,{conversation:e,message:t})]})};var ee={wrapper:"_wrapper_9g5he_1",loading:"_loading_9g5he_8",beginning:"_beginning_9g5he_15"};var vt=(e,t,o)=>e.some(r=>dateFns.isAfter(r.sentAt,t)&&dateFns.isBefore(r.sentAt,o)),ht=({clientAddress:e="",conversation:t,isLoading:o=!1,messages:r=[]})=>{let a=react.useMemo(()=>r.filter(p=>p.senderAddress===e),[r,e]);if(o&&!r.length)return jsxRuntime.jsx("div",{className:ee.loading,children:Array.from({length:3}).map((p,i)=>jsxRuntime.jsxs(react.Fragment,{children:[jsxRuntime.jsx(G,{incoming:!1})," ",jsxRuntime.jsx(G,{})]},i))});let n=[],s=reactSdk.getReadReceipt(t);return jsxRuntime.jsx("div",{"data-testid":"message-tile-container",className:ee.wrapper,children:r.map((p,i,d)=>{n.length===0&&n.push(p.sentAt);let h=n.at(-1),m=p.senderAddress!==e,H=p.senderAddress===e,K=i===0,A=i===d.length-1,Me=dateFns.isSameDay(h,p.sentAt),ie=K||A||!Me;ie&&!A&&n.push(p.sentAt);let Pe=s&&H&&dateFns.isBefore(p.sentAt,s)&&(A||!vt(a,p.sentAt,s));return jsxRuntime.jsxs(react.Fragment,{children:[ie&&jsxRuntime.jsx(V,{date:n.at(-1)}),jsxRuntime.jsx(Z,{conversation:t,message:p,isIncoming:m,isRead:Pe},p.id)]},p.id)})})};var w={wrapper:"_wrapper_133pc_3",light:"_light_133pc_7",dark:"_dark_133pc_11",element:"_element_133pc_15 spin",elementSmall:"_elementSmall_133pc_22",elementLarge:"_elementLarge_133pc_28"};var te=({size:e,color:t="primary"})=>jsxRuntime.jsx("div",{className:w.wrapper,children:jsxRuntime.jsx("div",{className:`${w.element} ${t==="primary"?w.light:w.dark} ${e==="small"?w.elementSmall:w.elementLarge}`})});var E={wrapper:"_wrapper_7iqve_1",disabled:"_disabled_7iqve_19",primary:"_primary_7iqve_28",secondary:"_secondary_7iqve_36"};var re=({label:e=jsxRuntime.jsx(outline.PlusCircleIcon,{width:"24",color:"white"}),variant:t="primary",isLoading:o=!1,isDisabled:r=!1,size:a="large",srText:n,onClick:s,testId:p})=>jsxRuntime.jsx("button",{"data-testid":p,type:"button",onClick:s,disabled:r,className:`${E.wrapper} ${E[t]} ${r?E.disabled:""}`,"aria-label":n,children:jsxRuntime.jsx("div",{children:o?jsxRuntime.jsx(te,{color:"primary",size:a}):e})});var q={label:"_label_1wlh2_1 visually-hidden",wrapper:"_wrapper_1wlh2_5",input:"_input_1wlh2_19"};var ke=32,Ae=react.forwardRef(({isDisabled:e,onSubmit:t,placeholder:o,submitSrText:r},a)=>{let n=react.useRef(null);react.useImperativeHandle(a,()=>n.current);let[s,p]=react.useState(""),i=m=>p(m.target.value),d=react.useCallback(m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),s&&(t?.(s),p("")));},[t,s]),h=react.useCallback(()=>{s&&(t?.(s),p(""));},[t,s]);return react.useLayoutEffect(()=>{if(n?.current?.value){let m=n?.current.scrollHeight;n.current.style.height=`${Math.max(m,ke)}px`;}else n?.current&&(n.current.style.height=`${ke}px`);},[s]),jsxRuntime.jsxs("div",{children:[o&&jsxRuntime.jsx("label",{htmlFor:"chat",className:q.label,children:o}),jsxRuntime.jsxs("div",{className:q.wrapper,children:[jsxRuntime.jsx("textarea",{name:"chat","data-testid":"message-input",onChange:i,onKeyDown:d,ref:n,rows:1,className:q.input,placeholder:o,value:s,disabled:e}),jsxRuntime.jsx(re,{testId:"message-input-submit",variant:"secondary",label:jsxRuntime.jsx(solid.ArrowUpIcon,{color:"white",width:"20"}),srText:r,onClick:h,isDisabled:!s||e})]})]})});Ae.displayName="MessageInput";var oe=e=>e.length>10&&e.startsWith("0x")?`${e.substring(0,6)}...${e.substring(e.length-4)}`:e;var ae=({conversation:e,onClick:t,isSelected:o,lastMessage:r})=>{let a=r?reactSdk.getAttachment(r):void 0,n;a?n=a.filename:typeof r?.content=="string"?n=r.content:r?.contentFallback&&(n=r.contentFallback);let s=react.useCallback(i=>{i.key==="Enter"&&t?.(e);},[e,t]),p=react.useCallback(()=>{t?.(e);},[e,t]);return jsxRuntime.jsxs("div",{className:`${g.wrapper} ${o?g.selected:""}`,role:"button",tabIndex:0,onKeyDown:s,onClick:p,children:[jsxRuntime.jsx(reactRouterDom.Link,{to:`/profile/${e.peerAddress}`,children:jsxRuntime.jsx(u,{address:e.peerAddress})}),jsxRuntime.jsxs("div",{className:g.element,children:[jsxRuntime.jsx("div",{className:g.address,children:oe(e.peerAddress)}),jsxRuntime.jsx("div",{className:g.message,children:n})]}),jsxRuntime.jsx("div",{className:g.time,children:r?.sentAt&&`${dateFns.formatDistanceToNowStrict(r.sentAt)} ago`})]})};var ne=({conversation:e,isSelected:t,onClick:o,lastMessage:r})=>{let a=react.useCallback(()=>{o?.(e);},[e,o]);return jsxRuntime.jsx(ae,{conversation:e,isSelected:t,onClick:a,lastMessage:r})};var Mt=({conversations:e=[],isLoading:t,onConversationClick:o,renderEmpty:r,selectedConversation:a})=>{let n=e.map(s=>jsxRuntime.jsx(ne,{conversation:s,isSelected:s.topic===a?.topic,onClick:o},s.topic));return jsxRuntime.jsx(W,{conversations:n,isLoading:t,renderEmpty:r})};

exports.AddressInput = se;
exports.Avatar = u;
exports.ButtonLoader = te;
exports.ConversationList = W;
exports.ConversationPreview = ne;
exports.ConversationPreviewCard = ae;
exports.ConversationPreviewList = Mt;
exports.DateDivider = V;
exports.IconButton = re;
exports.Message = Z;
exports.MessageInput = Ae;
exports.Messages = ht;
exports.ReactionsBar = Q;
exports.shortAddress = oe;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.cjs.map